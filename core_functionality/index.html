
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://gess-research-group.github.io/pyshbundle/core_functionality/">
      
      
        <link rel="prev" href="../convert_data_formats/">
      
      
        <link rel="next" href="../auxillary_codes/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.39">
    
    
      
        <title>Core Functionality - pyshbundle</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#core-functionality" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="pyshbundle" class="md-header__button md-logo" aria-label="pyshbundle" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pyshbundle
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Core Functionality
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/GESS-research-group/pyshbundle" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="pyshbundle" class="md-nav__button md-logo" aria-label="pyshbundle" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    pyshbundle
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/GESS-research-group/pyshbundle" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../theory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Theoretical Background
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/GESS-research-group/pyshbundle/issues" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Report Issues
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference Manual
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Reference Manual
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pyshbundle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pyshbundle Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../load_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Load Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../convert_data_formats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Convert Data Formats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Core Functionality
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Core Functionality
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spherical-harmonic-analysis-and-synthesis" class="md-nav__link">
    <span class="md-ellipsis">
      Spherical Harmonic Analysis and Synthesis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyshbundle.pysh_core.gsha" class="md-nav__link">
    <span class="md-ellipsis">
      gsha
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyshbundle.pysh_core.gshs" class="md-nav__link">
    <span class="md-ellipsis">
      gshs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyshbundle.pysh_core.PhaseCalc" class="md-nav__link">
    <span class="md-ellipsis">
      PhaseCalc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intro-to-grace-data-driven-correction" class="md-nav__link">
    <span class="md-ellipsis">
      Intro to Grace Data Driven Correction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyshbundle.pysh_core.GRACE_Data_Driven_Correction_Vishwakarma" class="md-nav__link">
    <span class="md-ellipsis">
      GRACE_Data_Driven_Correction_Vishwakarma
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydrological-applications-with-grace" class="md-nav__link">
    <span class="md-ellipsis">
      Hydrological Applications with GRACE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyshbundle.hydro.Basinaverage" class="md-nav__link">
    <span class="md-ellipsis">
      Basinaverage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyshbundle.hydro.TWSCalc" class="md-nav__link">
    <span class="md-ellipsis">
      TWSCalc
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../auxillary_codes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Auxillary Codes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../acknowledgement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledgement
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spherical-harmonic-analysis-and-synthesis" class="md-nav__link">
    <span class="md-ellipsis">
      Spherical Harmonic Analysis and Synthesis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyshbundle.pysh_core.gsha" class="md-nav__link">
    <span class="md-ellipsis">
      gsha
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyshbundle.pysh_core.gshs" class="md-nav__link">
    <span class="md-ellipsis">
      gshs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyshbundle.pysh_core.PhaseCalc" class="md-nav__link">
    <span class="md-ellipsis">
      PhaseCalc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intro-to-grace-data-driven-correction" class="md-nav__link">
    <span class="md-ellipsis">
      Intro to Grace Data Driven Correction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyshbundle.pysh_core.GRACE_Data_Driven_Correction_Vishwakarma" class="md-nav__link">
    <span class="md-ellipsis">
      GRACE_Data_Driven_Correction_Vishwakarma
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydrological-applications-with-grace" class="md-nav__link">
    <span class="md-ellipsis">
      Hydrological Applications with GRACE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyshbundle.hydro.Basinaverage" class="md-nav__link">
    <span class="md-ellipsis">
      Basinaverage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyshbundle.hydro.TWSCalc" class="md-nav__link">
    <span class="md-ellipsis">
      TWSCalc
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="core-functionality">Core functionality<a class="headerlink" href="#core-functionality" title="Permanent link">&para;</a></h1>
<p>The core functionality is processing spherical harmonics coefficients to mass change fields.</p>
<h2 id="spherical-harmonic-analysis-and-synthesis">Spherical Harmonic Analysis and Synthesis<a class="headerlink" href="#spherical-harmonic-analysis-and-synthesis" title="Permanent link">&para;</a></h2>
<p><code>gsha(f, method: str, grid: str = None, lmax: int = -9999):</code>
</p>


<div class="doc doc-object doc-function">



<a id="pyshbundle.pysh_core.gsha"></a>
    <div class="doc doc-contents first">

        <p>Global Spherical Harmonic Analysis, inverse of GSHS.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>f</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Global field of size (l_max + 1) * 2 * l_max or l_max * 2 * l_max.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>method</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method to be used. One of:
'ls': least squares
'wls': weighted least squares
'aq': approximate quadrature
'fnm': first Neumann method
'snm': second Neumann method
'mean': block mean values (use of integrated Plm)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>grid</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Choose between 'block' or 'cell'. Defaults to None. One of:
'pole': equi-angular (l_max+1)<em>2</em>l_max, including poles and Greenwich meridian.
'mesh': equi-angular (l_max+1)<em>2</em>l_max, including poles and Greenwich meridian.
'block': equi-angular block midpoints l_max<em>2</em>l_max
'cell': equi-angular block midpoints l_max<em>2</em>l_max
'neumann': Gauss-Neumann grid (l_max+1)<em>2</em>l_max
'gauss': Gauss-Neumann grid (l_max+1)<em>2</em>l_max</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lmax</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum degree of development. Defaults to -9999.</p>
              </div>
            </td>
            <td>
                  <code>-9999</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spherical harmonics coefficients Clm, Slm in |C\S| format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If grid argument is not 'block' or 'cell'.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If grid type is not recognized.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>TypeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If invalid size of matrix F.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>TypeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If GRID and METHOD are not strings.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If 2nd Neumann method is used on a non-'neumann'/'gauss' GRID.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If Block mean method is used on a non-'block'/'cell' GRID.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If maximum degree of development is higher than number of rows of input.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <p>TBD - Zlm-functions option
    - eigengrav, GRS80
    - When 'pole' grid, m = 1 yields singular Plm-matrix!</p>
</details>

<details class="uses" open>
  <summary>Uses</summary>
  <p><code>plm</code>, <code>neumann</code>, <code>iplm</code>, <code>sc2cs</code></p>
</details>

<details class="author" open>
  <summary>Author</summary>
  <p>Amin Shakya, Interdisciplinary Center for Water Research (ICWaR), Indian Institute of Science (IISc)</p>
</details>
            <details class="quote">
              <summary>Source code in <code>pyshbundle/pysh_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">gsha</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lmax</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Global Spherical Harmonic Analysis, inverse of GSHS.</span>

<span class="sd">    Args:</span>
<span class="sd">        f (numpy.ndarray): Global field of size (l_max + 1) * 2 * l_max or l_max * 2 * l_max.</span>
<span class="sd">        method (str): Method to be used. One of:</span>
<span class="sd">            &#39;ls&#39;: least squares</span>
<span class="sd">            &#39;wls&#39;: weighted least squares</span>
<span class="sd">            &#39;aq&#39;: approximate quadrature</span>
<span class="sd">            &#39;fnm&#39;: first Neumann method</span>
<span class="sd">            &#39;snm&#39;: second Neumann method</span>
<span class="sd">            &#39;mean&#39;: block mean values (use of integrated Plm)</span>
<span class="sd">        grid (str, optional): Choose between &#39;block&#39; or &#39;cell&#39;. Defaults to None. One of:</span>
<span class="sd">            &#39;pole&#39;: equi-angular (l_max+1)*2*l_max, including poles and Greenwich meridian.</span>
<span class="sd">            &#39;mesh&#39;: equi-angular (l_max+1)*2*l_max, including poles and Greenwich meridian.</span>
<span class="sd">            &#39;block&#39;: equi-angular block midpoints l_max*2*l_max</span>
<span class="sd">            &#39;cell&#39;: equi-angular block midpoints l_max*2*l_max</span>
<span class="sd">            &#39;neumann&#39;: Gauss-Neumann grid (l_max+1)*2*l_max</span>
<span class="sd">            &#39;gauss&#39;: Gauss-Neumann grid (l_max+1)*2*l_max</span>
<span class="sd">        lmax (int, optional): Maximum degree of development. Defaults to -9999.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (numpy.ndarray): Spherical harmonics coefficients Clm, Slm in |C\S| format.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If grid argument is not &#39;block&#39; or &#39;cell&#39;.</span>
<span class="sd">        ValueError: If grid type is not recognized.</span>
<span class="sd">        TypeError: If invalid size of matrix F.</span>
<span class="sd">        TypeError: If GRID and METHOD are not strings.</span>
<span class="sd">        ValueError: If 2nd Neumann method is used on a non-&#39;neumann&#39;/&#39;gauss&#39; GRID.</span>
<span class="sd">        ValueError: If Block mean method is used on a non-&#39;block&#39;/&#39;cell&#39; GRID.</span>
<span class="sd">        ValueError: If maximum degree of development is higher than number of rows of input.</span>

<span class="sd">    Notes:</span>
<span class="sd">        TBD - Zlm-functions option</span>
<span class="sd">            - eigengrav, GRS80</span>
<span class="sd">            - When &#39;pole&#39; grid, m = 1 yields singular Plm-matrix!</span>

<span class="sd">    Uses:</span>
<span class="sd">        `plm`, `neumann`, `iplm`, `sc2cs`</span>

<span class="sd">    Author:</span>
<span class="sd">        Amin Shakya, Interdisciplinary Center for Water Research (ICWaR), Indian Institute of Science (IISc)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">if</span> <span class="n">cols</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rows</span><span class="p">:</span> <span class="c1">#Check conditions</span>
        <span class="k">if</span> <span class="n">lmax</span> <span class="o">==</span> <span class="o">-</span><span class="mi">9999</span><span class="p">:</span>
            <span class="n">lmax</span> <span class="o">=</span> <span class="n">rows</span>

        <span class="k">if</span> <span class="n">grid</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="s1">&#39;block&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">grid</span> <span class="o">!=</span> <span class="s1">&#39;block&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">grid</span> <span class="o">!=</span> <span class="s1">&#39;cell&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Your GRID variable should be either block or cell&quot;</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">rows</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">n</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">180</span><span class="o">+</span><span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span> <span class="n">dt</span><span class="p">)</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">360</span><span class="o">+</span><span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span> <span class="n">dt</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">cols</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rows</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lmax</span> <span class="o">==</span> <span class="o">-</span><span class="mi">9999</span><span class="p">:</span>
            <span class="n">lmax</span> <span class="o">=</span> <span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">grid</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="s1">&#39;pole&#39;</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">n</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">grid</span> <span class="o">==</span> <span class="s1">&#39;pole&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">grid</span> <span class="o">==</span> <span class="s1">&#39;mesh&#39;</span><span class="p">):</span>                   
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="o">+</span><span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span> <span class="n">dt</span><span class="p">)</span>
            <span class="n">lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="o">+</span><span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">grid</span> <span class="o">==</span> <span class="s1">&#39;neumann&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">grid</span> <span class="o">==</span> <span class="s1">&#39;gauss&#39;</span><span class="p">):</span> 
        <span class="c1"># gw, gx = neumann(n+1) #For some reason, grule does not work for even values</span>
            <span class="n">gw</span><span class="p">,</span> <span class="n">gx</span> <span class="o">=</span> <span class="n">neumann</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">gx</span><span class="p">))</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="o">+</span><span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gw</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">gw</span> <span class="o">=</span> <span class="n">gw</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">gw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">gx</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">gx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Grid type entered is incorrect&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid size of matrix F&quot;</span><span class="p">)</span>

    <span class="n">theRAD</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
    <span class="c1"># if len(theRAD.shape) == 1:</span>
    <span class="c1"># theRAD = theRAD.reshape(theRAD.shape[0],1)</span>


    <span class="c1"># further diagnostics</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;GRID and METHOD must be strings.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;snm&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="n">grid</span> <span class="o">!=</span> <span class="s1">&#39;neumann&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">grid</span> <span class="o">!=</span> <span class="s1">&#39;gauss&#39;</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;2nd Neumann method ONLY on a &#39;&#39;neumann&#39;&#39;/&#39;&#39;gauss&#39;&#39; GRID&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="n">grid</span> <span class="o">!=</span> <span class="s1">&#39;block&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">grid</span> <span class="o">!=</span> <span class="s1">&#39;cell&#39;</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Block mean method ONLY on a &#39;&#39;block&#39;&#39;/&#39;&#39;cell&#39;&#39; GRID&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lmax</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Maximum degree of development is higher than number of rows of input.&#39;</span><span class="p">)</span>

    <span class="c1"># Reshape variables as required</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lam</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="n">lam</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">lam</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Init</span>

    <span class="n">L</span> <span class="o">=</span> <span class="n">n</span>
    <span class="n">clm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
    <span class="n">slm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>


    <span class="c1"># First step of analysis</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">lam</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">lam</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>


    <span class="c1"># % preserving the orthogonality (except for &#39;mean&#39; case)</span>
    <span class="c1"># % we distinguish between &#39;block&#39; and &#39;pole&#39; type grids (in lambda)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">grid</span> <span class="o">==</span> <span class="s1">&#39;block&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">grid</span> <span class="o">==</span> <span class="s1">&#39;cell&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
            <span class="n">dl</span> <span class="o">=</span> <span class="n">dt</span>
            <span class="n">c</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dl</span> <span class="o">/</span> <span class="mi">360</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ms</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">dl</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">c</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ms</span>  
            <span class="n">s</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ms</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="n">L</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="n">L</span>
            <span class="n">c</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">s</span><span class="p">[:,</span><span class="n">L</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:,</span><span class="n">L</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">c</span><span class="p">[:,</span><span class="n">L</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
            <span class="n">s</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="n">L</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="n">L</span>
        <span class="n">c</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">]]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">]]</span><span class="o">/</span><span class="mi">2</span>	
        <span class="n">s</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>	  


    <span class="n">a</span> <span class="o">=</span> <span class="n">f</span> <span class="o">@</span> <span class="n">c</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">f</span> <span class="o">@</span> <span class="n">s</span>    

    <span class="c1"># Second step of analysis: Clm and Slm</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;ls&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
<span class="c1">#            l = np.arange(m,L+1)</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">T</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">plm</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">theRAD</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ai</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span>
            <span class="n">bi</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span>

            <span class="n">clm</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">L</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span>
            <span class="n">slm</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">L</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">bi</span><span class="p">)</span>


    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;aq&#39;</span><span class="p">:</span> <span class="c1">#Approximate Quadrature</span>
        <span class="n">si</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theRAD</span><span class="p">)</span>
        <span class="n">si</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">si</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">T</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">plm</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">theRAD</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">ai</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span>
            <span class="n">bi</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span>

            <span class="n">clm</span><span class="p">[</span><span class="n">m</span><span class="p">:</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span><span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">si</span> <span class="o">*</span> <span class="n">ai</span><span class="p">)</span>
            <span class="n">slm</span><span class="p">[</span><span class="n">m</span><span class="p">:</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span><span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">si</span> <span class="o">*</span> <span class="n">bi</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;fnm&#39;</span><span class="p">:</span> <span class="c1">#1st Neumann method (exact upto L/2)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">neumann</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theRAD</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">T</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">plm</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">theRAD</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">ai</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span>
            <span class="n">bi</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span>

            <span class="n">clm</span><span class="p">[</span><span class="n">m</span><span class="p">:</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span><span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">ai</span><span class="p">)</span>
            <span class="n">slm</span><span class="p">[</span><span class="n">m</span><span class="p">:</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span><span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">bi</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;snm&#39;</span><span class="p">:</span> <span class="c1">#2nd Neumann method (exact)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">T</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">plm</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">theRAD</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">ai</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span>
            <span class="n">bi</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span>

            <span class="n">clm</span><span class="p">[</span><span class="n">m</span><span class="p">:</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span><span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">gw</span> <span class="o">*</span> <span class="n">ai</span><span class="p">)</span>
            <span class="n">slm</span><span class="p">[</span><span class="n">m</span><span class="p">:</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span><span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">gw</span> <span class="o">*</span> <span class="n">bi</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="c1">#l = np.arange(m,L+1).reshape(L+1-m,1)</span>
            <span class="c1">#l = l.T</span>


            <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="c1"># l = np.array([[m]])</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">iplm</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">theRAD</span><span class="p">)</span>
        <span class="c1"># p = p[:,-1]</span>
            <span class="n">ai</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span>
            <span class="n">bi</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span>

            <span class="n">clm</span><span class="p">[</span><span class="n">m</span><span class="p">:</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span><span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">ai</span>
            <span class="n">slm</span><span class="p">[</span><span class="n">m</span><span class="p">:</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span><span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">bi</span>

    <span class="c1"># Write the coefficients Clm &amp; Slm in |C\S| format</span>

    <span class="n">slm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">slm</span><span class="p">)</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">sc2cs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">slm</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">L</span><span class="p">)],</span> <span class="n">clm</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">cs</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>


    <span class="k">return</span> <span class="n">cs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><p><code>gshs(field, quant = 'none', grd = 'mesh', n = -9999, h = 0, jflag = 1):</code>
</p>


<div class="doc doc-object doc-function">



<a id="pyshbundle.pysh_core.gshs"></a>
    <div class="doc doc-contents first">

        <p>Global Spherical Harmonic Synthesis.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>field</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of SH coefficients, either in SC-triangle or CS-square format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>quant</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Defines the field quantity. Defaults to 'none'. One of:
'geoid': geoid height [m]
'potential': potential [m^2/s^2]
'dg', 'gravity': gravity anomaly [mGal]
'tr': grav. disturbance, 1st rad. derivative [mGal]
'trr': 2nd rad. derivative [1/s^2]
'water': equivalent water height [m]
'smd': surface mass density [kg/m^2]</p>
              </div>
            </td>
            <td>
                  <code>&#39;none&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>grd</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Defines the grid. Defaults to 'mesh'. One of:
'pole', 'mesh': equi-angular (n+1)<em>2n, includes poles/Greenwich meridian.
'block', 'cell': equi-angular block midpoints, n</em>2n.
'neumann', 'gauss': Gauss-grid (n+1)*2n.</p>
              </div>
            </td>
            <td>
                  <code>&#39;mesh&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>n</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Degree of harmonics. Defaults to -9999 (lmax).</p>
              </div>
            </td>
            <td>
                  <code>-9999</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>h</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height above Earth mean radius [m]. Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>jflag</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Subtracts GRS80 when set. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>numpy.ndarray: The global Spherical Harmonics field.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>numpy.ndarray: Vector of co-latitudes in radians.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>numpy.ndarray: Vector of longitudes in radians.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the format of the field is incorrect.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If n is not scalar.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If n is not an integer.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the grid argument is not a string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="uses" open>
  <summary>Uses</summary>
  <p><code>cs2sc</code>, <code>normalklm</code>, <code>plm</code>, <code>eigengrav</code>, <code>ispec</code></p>
</details>

<details class="todo" open>
  <summary>Todo</summary>
  <ul>
<li>Change general exceptions to specific and descriptive built-in ones.</li>
<li>Using the not and then check is not always advisable.</li>
<li>Check how to document valid options.</li>
</ul>
</details>

<details class="author" open>
  <summary>Author</summary>
  <p>Amin Shakya, Interdisciplinary Center for Water Research (ICWaR), Indian Institute of Science (IISc)
Vivek Kumar Yadav, Interdisciplinary Center for Water Research (ICWaR), Indian Institute of Science (IISc)</p>
</details>
            <details class="quote">
              <summary>Source code in <code>pyshbundle/pysh_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">gshs</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">quant</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">grd</span> <span class="o">=</span> <span class="s1">&#39;mesh&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jflag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Global Spherical Harmonic Synthesis.</span>

<span class="sd">    Args:</span>
<span class="sd">        field (numpy.ndarray): Matrix of SH coefficients, either in SC-triangle or CS-square format.</span>
<span class="sd">        quant (str, optional): Defines the field quantity. Defaults to &#39;none&#39;. One of:</span>
<span class="sd">            &#39;geoid&#39;: geoid height [m]</span>
<span class="sd">            &#39;potential&#39;: potential [m^2/s^2]</span>
<span class="sd">            &#39;dg&#39;, &#39;gravity&#39;: gravity anomaly [mGal]</span>
<span class="sd">            &#39;tr&#39;: grav. disturbance, 1st rad. derivative [mGal]</span>
<span class="sd">            &#39;trr&#39;: 2nd rad. derivative [1/s^2]</span>
<span class="sd">            &#39;water&#39;: equivalent water height [m]</span>
<span class="sd">            &#39;smd&#39;: surface mass density [kg/m^2]</span>
<span class="sd">        grd (str, optional): Defines the grid. Defaults to &#39;mesh&#39;. One of:</span>
<span class="sd">            &#39;pole&#39;, &#39;mesh&#39;: equi-angular (n+1)*2n, includes poles/Greenwich meridian.</span>
<span class="sd">            &#39;block&#39;, &#39;cell&#39;: equi-angular block midpoints, n*2n.</span>
<span class="sd">            &#39;neumann&#39;, &#39;gauss&#39;: Gauss-grid (n+1)*2n.</span>
<span class="sd">        n (int, optional): Degree of harmonics. Defaults to -9999 (lmax).</span>
<span class="sd">        h (int, optional): Height above Earth mean radius [m]. Defaults to 0.</span>
<span class="sd">        jflag (int, optional): Subtracts GRS80 when set. Defaults to 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        numpy.ndarray: The global Spherical Harmonics field.</span>
<span class="sd">        numpy.ndarray: Vector of co-latitudes in radians.</span>
<span class="sd">        numpy.ndarray: Vector of longitudes in radians.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If the format of the field is incorrect.</span>
<span class="sd">        Exception: If n is not scalar.</span>
<span class="sd">        Exception: If n is not an integer.</span>
<span class="sd">        Exception: If the grid argument is not a string.</span>

<span class="sd">    Uses:</span>
<span class="sd">        `cs2sc`, `normalklm`, `plm`, `eigengrav`, `ispec`</span>

<span class="sd">    Todo:</span>
<span class="sd">        * Change general exceptions to specific and descriptive built-in ones.</span>
<span class="sd">        * Using the not and then check is not always advisable.</span>
<span class="sd">        * Check how to document valid options.</span>

<span class="sd">    Author:</span>
<span class="sd">        Amin Shakya, Interdisciplinary Center for Water Research (ICWaR), Indian Institute of Science (IISc)</span>
<span class="sd">        Vivek Kumar Yadav, Interdisciplinary Center for Water Research (ICWaR), Indian Institute of Science (IISc)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">wd</span> <span class="o">=</span> <span class="n">getcwd</span><span class="p">()</span>
    <span class="n">chdir</span><span class="p">(</span><span class="n">wd</span><span class="p">)</span>

    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">if</span> <span class="n">rows</span> <span class="o">==</span> <span class="n">cols</span><span class="p">:</span>                    <span class="c1">#field in CS-format </span>
        <span class="n">lmax</span> <span class="o">=</span> <span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">cs2sc</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">cols</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rows</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>         <span class="c1">#field in SC-format already</span>
        <span class="n">lmax</span> <span class="o">=</span> <span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Check format of the field&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="o">-</span><span class="mi">9999</span><span class="p">:</span>                      <span class="c1">#(no value of n is input) -&gt; set n = lmax</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">lmax</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;n must be scalar&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;n must be integer&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">grd</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Grid argument must be string&quot;</span><span class="p">)</span>

    <span class="n">grd</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>



    <span class="c1">#Grid Definition</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span>

    <span class="k">if</span> <span class="n">grd</span> <span class="o">==</span> <span class="s1">&#39;pole&#39;</span> <span class="ow">or</span> <span class="n">grd</span> <span class="o">==</span> <span class="s1">&#39;mesh&#39;</span><span class="p">:</span>
        <span class="n">theRAD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
        <span class="n">lamRAD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">grd</span> <span class="o">==</span> <span class="s1">&#39;block&#39;</span> <span class="ow">or</span> <span class="n">grd</span> <span class="o">==</span> <span class="s1">&#39;cell&#39;</span><span class="p">:</span>
        <span class="n">theRAD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
        <span class="n">lamRAD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Incorrect grid type input&quot;</span><span class="p">)</span>

    <span class="n">nlat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theRAD</span><span class="p">)</span>
    <span class="n">nlon</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lamRAD</span><span class="p">)</span>



<span class="c1">#   -------------------------------------------------------------------------</span>
<span class="c1">#   Preprocessing on the coefficients:</span>
        <span class="c1"># - subtract reference field (if jflag is set)</span>
        <span class="c1"># - specific transfer</span>
        <span class="c1"># - upward continuation</span>
<span class="c1">#   -------------------------------------------------------------------------</span>

    <span class="k">if</span> <span class="n">jflag</span><span class="p">:</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">field</span> <span class="o">-</span> <span class="n">cs2sc</span><span class="p">(</span><span class="n">normalklm</span><span class="p">(</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">transf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">eigengrav</span><span class="p">(</span><span class="n">lmax</span><span class="p">,</span> <span class="n">quant</span><span class="p">,</span> <span class="n">h</span><span class="p">)])[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>

    <span class="n">field</span> <span class="o">=</span> <span class="n">field</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">transf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>



<span class="c1"># -------------------------------------------------------------------------</span>
        <span class="c1"># Size declarations and start the waitbar:</span>
        <span class="c1"># Note that the definition of dlam causes straight zero-padding in case N &gt; L.</span>
        <span class="c1"># When N &lt; L, there will be zero-padding up to the smallest integer multiple</span>
        <span class="c1"># of N larger than L. After the Fourier transformation (see below), the</span>
        <span class="c1"># proper samples have to be picked out, with stepsize dlam.</span>
<span class="c1"># -------------------------------------------------------------------------</span>


    <span class="n">dlam</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">lmax</span><span class="o">/</span><span class="n">n</span><span class="p">))</span>             <span class="c1">#longitude step size</span>
    <span class="n">abcols</span> <span class="o">=</span> <span class="n">dlam</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>                     <span class="c1">#columns required in A and B</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nlat</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">abcols</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nlat</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">abcols</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>



    <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="n">m</span><span class="p">:</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">lmax</span><span class="o">+</span><span class="n">m</span><span class="p">]</span> 
    <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">plm</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">theRAD</span><span class="p">,</span> <span class="n">nargin</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nargout</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)[:,:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">a</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> 
    <span class="n">b</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nlat</span><span class="p">)</span> 



    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="n">m</span><span class="p">:</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">lmax</span><span class="o">+</span><span class="n">m</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="n">m</span><span class="p">:</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">lmax</span><span class="o">-</span><span class="n">m</span><span class="p">]</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">plm</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">theRAD</span><span class="p">,</span> <span class="n">nargin</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nargout</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)[:,:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
        <span class="n">b</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

    <span class="k">del</span> <span class="n">field</span>


<span class="c1">#   -------------------------------------------------------------------------</span>
        <span class="c1"># The second synthesis step consists of an inverse Fourier transformation</span>
        <span class="c1"># over the rows of a and b. </span>
        <span class="c1"># In case of &#39;block&#39;, the spectrum has to be shifted first.</span>
        <span class="c1"># When no zero-padding has been applied, the last b-coefficients must be set to</span>
        <span class="c1"># zero. Otherwise the number of longitude samples will be 2N+1 instead of 2N.</span>
        <span class="c1"># For N=L this corresponds to setting SLL=0!</span>
<span class="c1">#  -------------------------------------------------------------------------</span>


    <span class="k">if</span> <span class="n">grd</span> <span class="o">==</span><span class="s1">&#39;block&#39;</span> <span class="ow">or</span> <span class="n">grd</span> <span class="o">==</span> <span class="s1">&#39;cell&#39;</span><span class="p">:</span> 
      <span class="n">m</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">abcols</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">cshift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nlat</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">);</span>	<span class="c1"># cshift/sshift describe the </span>
      <span class="n">sshift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nlat</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">);</span>	<span class="c1"># half-blocksize lambda shift.</span>
      <span class="n">atemp</span>  <span class="o">=</span>  <span class="n">cshift</span><span class="o">*</span><span class="n">a</span> <span class="o">+</span> <span class="n">sshift</span><span class="o">*</span><span class="n">b</span>
      <span class="n">b</span>      <span class="o">=</span> <span class="o">-</span><span class="n">sshift</span><span class="o">*</span><span class="n">a</span> <span class="o">+</span> <span class="n">cshift</span><span class="o">*</span><span class="n">b</span>
      <span class="n">a</span>      <span class="o">=</span> <span class="n">atemp</span>



    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">lmax</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>               <span class="c1">#Case without zero-padding</span>
        <span class="n">b</span><span class="p">[:,</span><span class="n">abcols</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nlat</span><span class="p">)</span>

    <span class="c1">#Code for ispec</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">ispec</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">if</span> <span class="n">dlam</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> 
        <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">dlam</span><span class="o">*</span><span class="n">nlon</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dlam</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">theRAD</span><span class="p">,</span> <span class="n">lamRAD</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><p><code>PhaseCalc(fts, ffts):</code>
</p>


<div class="doc doc-object doc-function">



<a id="pyshbundle.pysh_core.PhaseCalc"></a>
    <div class="doc doc-contents first">

        <p>Calculates the phase difference between two time series based on the
Hilbert transform method explained by Phillip et al.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fts</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time-series 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ffts</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time-series 2.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Phase difference between the two time series.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="references" open>
  <summary>References</summary>
  <p>Phillips, T., R. S. Nerem, B. Fox-Kemper, J. S. Famiglietti, and B. Rajagopalan (2012),
The influence of ENSO on global terrestrial water storage using GRACE, Geophysical
Research Letters, 39 (16), L16,705, doi:10.1029/2012GL052495.</p>
</details>

<details class="author" open>
  <summary>Author</summary>
  <p>Amin Shakya, Interdisciplinary Center for Water Research (ICWaR), Indian Institute of Science (IISc)</p>
</details>
            <details class="quote">
              <summary>Source code in <code>pyshbundle/pysh_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">PhaseCalc</span><span class="p">(</span><span class="n">fts</span><span class="p">,</span> <span class="n">ffts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the phase difference between two time series based on the</span>
<span class="sd">    Hilbert transform method explained by Phillip et al.</span>

<span class="sd">    Args:</span>
<span class="sd">        fts (numpy.ndarray): Time-series 1.</span>
<span class="sd">        ffts (numpy.ndarray): Time-series 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (numpy.ndarray): Phase difference between the two time series.</span>

<span class="sd">    References:</span>
<span class="sd">        Phillips, T., R. S. Nerem, B. Fox-Kemper, J. S. Famiglietti, and B. Rajagopalan (2012),</span>
<span class="sd">        The influence of ENSO on global terrestrial water storage using GRACE, Geophysical</span>
<span class="sd">        Research Letters, 39 (16), L16,705, doi:10.1029/2012GL052495.</span>

<span class="sd">    Author:</span>
<span class="sd">        Amin Shakya, Interdisciplinary Center for Water Research (ICWaR), Indian Institute of Science (IISc)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">fts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="n">filter_</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fts</span><span class="p">)</span>
    <span class="n">filter__</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ffts</span><span class="p">)</span>

    <span class="n">fts_</span> <span class="o">=</span> <span class="n">fts</span><span class="p">[</span><span class="n">filter_</span><span class="p">]</span> <span class="c1">#Extract values and leave Nan</span>
    <span class="n">ffts_</span> <span class="o">=</span> <span class="n">ffts</span><span class="p">[</span><span class="n">filter__</span><span class="p">]</span> <span class="c1">#Extract values and leave Nan</span>

    <span class="n">fts</span> <span class="o">=</span> <span class="n">fts_</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fts_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">c</span><span class="p">),</span><span class="n">c</span><span class="p">)</span>
    <span class="n">ffts</span> <span class="o">=</span> <span class="n">ffts_</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ffts_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">c</span><span class="p">),</span><span class="n">c</span><span class="p">)</span>

    <span class="n">rn</span> <span class="o">=</span> <span class="n">fts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="c1"># A = np.concatenate(np.ones((rn,1)), np.real(signal.hilbert(ffts[:, i])), np.imag(signal.hilbert(ffts[:, i]))) #design matrix</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">rn</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">hilbert</span><span class="p">(</span><span class="n">ffts</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">hilbert</span><span class="p">(</span><span class="n">ffts</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]))))</span><span class="o">.</span><span class="n">T</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">fts</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>
        <span class="n">abc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">B</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">abc</span><span class="p">[</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="c1">#check indices and degree/radian</span>
    <span class="k">return</span> <span class="n">ps</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="intro-to-grace-data-driven-correction">Intro to Grace Data Driven Correction<a class="headerlink" href="#intro-to-grace-data-driven-correction" title="Permanent link">&para;</a></h2>
<p><code>GRACE_Data_Driven_Correction_Vishwakarma(F, cf, GaussianR, basins):</code>
</p>


<div class="doc doc-object doc-function">



<a id="pyshbundle.pysh_core.GRACE_Data_Driven_Correction_Vishwakarma"></a>
    <div class="doc doc-contents first">

        <p>Signal leakage correction using data-driven methods.</p>
<p>When GRACE data is applied for hydrological studies, the signal leakage is a common
problem. This function uses data-driven methods to correct signal leakage in GRACE data.
Please refer to paper (1) above for more details.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>F</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A cell matrix with one column containing SH coefficients.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cf</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The column in F that contains SH coefficients from GRACE.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>GaussianR</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Radius of the Gaussian filter (recommended = 400).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>basins</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mask functions of basin, a cell data format with one
column and each entry is a 360 x 720 matrix with 1 inside the
catchment and 0 outside.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
- RecoveredTWS (numpy.ndarray): Corrected data-driven time-series (Least Squares fit method).
- RecoveredTWS2 (numpy.ndarray): Corrected data-driven time-series (shift and amplify method).
- FilteredTS (numpy.ndarray): Gaussian filtered GRACE TWS time-series for all the basins.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there is an error in the corrected data-driven time-series (Least Squares fit method).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there is an error in the corrected data-driven time-series (shift and amplify method).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there is an error in the Gaussian filtered GRACE TWS time-series for all the basins.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="author" open>
  <summary>Author</summary>
  <p>Amin Shakya, Interdisciplinary Center for Water Research (ICWaR), Indian Institute of Science (IISc)</p>
</details>
            <details class="quote">
              <summary>Source code in <code>pyshbundle/pysh_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">GRACE_Data_Driven_Correction_Vishwakarma</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">cf</span><span class="p">,</span> <span class="n">GaussianR</span><span class="p">,</span> <span class="n">basins</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Signal leakage correction using data-driven methods.</span>

<span class="sd">    When GRACE data is applied for hydrological studies, the signal leakage is a common</span>
<span class="sd">    problem. This function uses data-driven methods to correct signal leakage in GRACE data.</span>
<span class="sd">    Please refer to paper (1) above for more details.</span>

<span class="sd">    Args:</span>
<span class="sd">        F (numpy.ndarray): A cell matrix with one column containing SH coefficients.</span>
<span class="sd">        cf (int): The column in F that contains SH coefficients from GRACE.</span>
<span class="sd">        GaussianR (float): Radius of the Gaussian filter (recommended = 400).</span>
<span class="sd">        basins (numpy.ndarray): Mask functions of basin, a cell data format with one</span>
<span class="sd">            column and each entry is a 360 x 720 matrix with 1 inside the</span>
<span class="sd">            catchment and 0 outside.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing:</span>
<span class="sd">            - RecoveredTWS (numpy.ndarray): Corrected data-driven time-series (Least Squares fit method).</span>
<span class="sd">            - RecoveredTWS2 (numpy.ndarray): Corrected data-driven time-series (shift and amplify method).</span>
<span class="sd">            - FilteredTS (numpy.ndarray): Gaussian filtered GRACE TWS time-series for all the basins.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If there is an error in the corrected data-driven time-series (Least Squares fit method).</span>
<span class="sd">        Exception: If there is an error in the corrected data-driven time-series (shift and amplify method).</span>
<span class="sd">        Exception: If there is an error in the Gaussian filtered GRACE TWS time-series for all the basins.</span>

<span class="sd">    Author:</span>
<span class="sd">        Amin Shakya, Interdisciplinary Center for Water Research (ICWaR), Indian Institute of Science (IISc)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">deg</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="o">-</span><span class="n">deg</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">360</span><span class="o">/</span><span class="n">deg</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="o">-</span><span class="n">deg</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">deg</span><span class="p">))</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">deg</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">360</span><span class="o">/</span><span class="n">deg</span><span class="p">))</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">deg</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">deg</span><span class="p">))</span>
    <span class="n">lambdd</span><span class="p">,</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>  
    <span class="n">lambdd1</span><span class="p">,</span><span class="n">theta1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">)</span>

    <span class="n">theta_rad</span> <span class="o">=</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">theta1_rad</span> <span class="o">=</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span>

    <span class="c1">#Areahalfdeg = (6378.137**2)*np.power(10,6)*np.pi/180*(np.multiply(a,b)) #Area matrix</span>
    <span class="n">Areahalfdeg</span> <span class="o">=</span> <span class="p">(</span><span class="mf">6378.137</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">*</span><span class="n">lambdd1</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">*</span><span class="n">lambdd</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">theta_rad</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">theta1_rad</span><span class="p">))</span>

    <span class="n">qty</span> <span class="o">=</span> <span class="s1">&#39;water&#39;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;input GRACE field should be in Numpy Ndarray format, please check guidelines&quot;</span><span class="p">)</span>


    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">basins</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;input basin field should be in Numpy NdArray format, please check guidelines&quot;</span><span class="p">)</span>


    <span class="n">r</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#No of entries in F numpy ndarrray</span>

    <span class="n">cid</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#number of river catchments</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">F</span><span class="p">[:,</span><span class="n">cf</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">cf</span><span class="p">]</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cfield</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cfield</span> <span class="o">==</span> <span class="n">l</span><span class="p">:</span>
        <span class="n">flag_cs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flag_cs</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">Weights</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">GaussianR</span><span class="p">)</span> 
    <span class="c1">#gaussian returns weights as a list #gaussian is np.array()</span>

    <span class="k">try</span><span class="p">:</span> <span class="c1">#Broadcase Weights into dimensions</span>
        <span class="n">filter_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">1</span><span class="p">,(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">Weights</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">w0</span> <span class="o">=</span> <span class="n">Weights</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Weights</span> <span class="o">=</span> <span class="n">Weights</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">w0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">filter_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">1</span><span class="p">,(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">Weights</span>


    <span class="c1">#SH Synthesis</span>
    <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="n">cfield</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">flag_cs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">Ft</span> <span class="o">=</span> <span class="n">cs2sc</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;double&#39;</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Ft</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;double&#39;</span><span class="p">)</span> 


            <span class="n">fFld__</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">gshs</span><span class="p">(</span><span class="n">Ft</span> <span class="o">*</span> <span class="n">filter_</span><span class="p">,</span> <span class="n">qty</span><span class="p">,</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">deg</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> 
            <span class="n">ffFld__</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">gshs</span><span class="p">((</span><span class="n">Ft</span> <span class="o">*</span> <span class="n">filter_</span> <span class="o">*</span> <span class="n">filter_</span><span class="p">),</span> <span class="n">qty</span><span class="p">,</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">deg</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fFld</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r</span><span class="p">,</span><span class="n">fFld__</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fFld__</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span> 
                <span class="n">ffFld</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">ffFld__</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ffFld__</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>

            <span class="n">fFld</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">fFld__</span>
            <span class="n">ffFld</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">ffFld__</span>

        <span class="n">long</span> <span class="o">=</span> <span class="mi">360</span><span class="o">/</span><span class="n">deg</span>
        <span class="n">Area</span> <span class="o">=</span> <span class="n">Areahalfdeg</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;enter CS coefficients&quot;</span><span class="p">)</span>



    <span class="c1">#Declaration of size of the vectors:</span>
    <span class="n">cid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">basins</span><span class="p">)</span> <span class="c1">#Here basins is a dictionary with each element storing nd array</span>
    <span class="n">tsleaktotalf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">cid</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>
    <span class="n">tsleaktotalff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">cid</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>

    <span class="n">ftsleaktotal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">cid</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>
    <span class="n">fftsleaktotal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">cid</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>

    <span class="n">lhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">cid</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>

    <span class="n">bfDevRegAv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">cid</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>
    <span class="n">bbfDevRegAv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">cid</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>

    <span class="n">FilteredTS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">cid</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>
    <span class="n">filfilts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">cid</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>

    <span class="n">leakage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">cid</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>
    <span class="n">leakager</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">cid</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>   



    <span class="k">for</span> <span class="n">rbasin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cid</span><span class="p">):</span>
        <span class="c1">#Get the basin functions ready</span>

        <span class="c1">#Basin functions, filtered basin function and transfer function Kappa</span>
        <span class="n">Rb</span> <span class="o">=</span> <span class="n">basins</span><span class="p">[</span><span class="n">rbasin</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">csRb</span> <span class="o">=</span> <span class="n">gsha</span><span class="p">(</span><span class="n">Rb</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;block&#39;</span><span class="p">,</span> <span class="n">long</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> 
        <span class="n">csF</span> <span class="o">=</span> <span class="n">cs2sc</span><span class="p">(</span><span class="n">csRb</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">l</span><span class="p">])</span> 
        <span class="n">filRb_</span> <span class="o">=</span> <span class="n">gshs</span><span class="p">(</span><span class="n">csF</span> <span class="o">*</span> <span class="n">filter_</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">long</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> 
        <span class="n">filRb</span> <span class="o">=</span> <span class="n">filRb_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Rb</span><span class="p">)</span> <span class="o">*</span> <span class="n">filRb</span>



        <span class="n">fF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">fFld__</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fFld__</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>
        <span class="n">ffF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">fFld__</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fFld__</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>


            <span class="n">fF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">fFld</span><span class="p">[</span><span class="n">m</span><span class="p">,:,</span><span class="nb">int</span><span class="p">(</span><span class="n">fF</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">):],</span> <span class="n">fFld</span><span class="p">[</span><span class="n">m</span><span class="p">,:,:</span><span class="nb">int</span><span class="p">(</span><span class="n">fF</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ffF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ffFld</span><span class="p">[</span><span class="n">m</span><span class="p">,:,</span><span class="nb">int</span><span class="p">(</span><span class="n">ffF</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">):],</span> <span class="n">ffFld</span><span class="p">[</span><span class="n">m</span><span class="p">,:,:</span><span class="nb">int</span><span class="p">(</span><span class="n">ffF</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1">#if False:    </span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fF</span><span class="p">[:</span><span class="mi">20</span><span class="p">,:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">():</span> <span class="c1">#if there is a gap in time series, fill it with NaNs</span>


                <span class="n">tsleaktotalf</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">rbasin</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">tsleaktotalff</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">rbasin</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">FilteredTS</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">rbasin</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">filfilts</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">rbasin</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">bfDevRegAv</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">rbasin</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">bbfDevRegAv</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">rbasin</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#leakage time series from filtered and twice filtered fields</span>
                <span class="n">tsleaktotalf</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">rbasin</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">fF</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">Area</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Rb</span> <span class="o">*</span> <span class="n">Area</span><span class="p">)</span>
                <span class="n">tsleaktotalff</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">rbasin</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ffF</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">Area</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Rb</span> <span class="o">*</span> <span class="n">Area</span><span class="p">)</span>

                <span class="c1">#time series from filtered fields</span>
                <span class="n">FilteredTS</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">rbasin</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">fF</span> <span class="o">*</span> <span class="n">Rb</span> <span class="o">*</span> <span class="n">Area</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Rb</span> <span class="o">*</span> <span class="n">Area</span><span class="p">)</span>
                <span class="n">filfilts</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">rbasin</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ffF</span> <span class="o">*</span> <span class="n">Rb</span> <span class="o">*</span> <span class="n">Area</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Rb</span> <span class="o">*</span> <span class="n">Area</span><span class="p">)</span>

                <span class="c1">#Deviation integral timeseries</span>
                <span class="n">bfDevRegAv</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">rbasin</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">fF</span> <span class="o">*</span> <span class="n">Rb</span> <span class="o">-</span> <span class="n">FilteredTS</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">rbasin</span><span class="p">])</span> <span class="o">*</span> <span class="n">filRb</span> <span class="o">*</span> <span class="n">Area</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Rb</span> <span class="o">*</span> <span class="n">Area</span><span class="p">)</span> <span class="c1">#working 2022-10-20</span>
                <span class="n">bbfDevRegAv</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">rbasin</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">ffF</span> <span class="o">*</span> <span class="n">Rb</span> <span class="o">-</span> <span class="n">filfilts</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">rbasin</span><span class="p">])</span> <span class="o">*</span> <span class="n">filRb</span> <span class="o">*</span> <span class="n">Area</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Rb</span> <span class="o">*</span> <span class="n">Area</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>





    <span class="n">b</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">bl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cid</span><span class="p">):</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">A</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">naninterp</span><span class="p">(</span><span class="n">bbfDevRegAv</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> <span class="c1">#Pchip interpolate should contain atleast two elements</span>

        <span class="n">lssol_</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">naninterp</span><span class="p">(</span><span class="n">bfDevRegAv</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]))</span> <span class="c1">#returns a tuple of solution &quot;x&quot;, residue and rank of matrix A; for A x = B</span>
        <span class="n">lssol</span> <span class="o">=</span> <span class="n">lssol_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 

        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lssol</span><span class="p">[</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>


        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">A</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">naninterp</span><span class="p">(</span><span class="n">tsleaktotalff</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
        <span class="n">lssol_</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">naninterp</span><span class="p">(</span><span class="n">tsleaktotalf</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]))</span> <span class="c1">#returns a tuple of solution &quot;x&quot;, residue and rank of matrix A; for A x = B</span>
        <span class="n">lssol</span> <span class="o">=</span> <span class="n">lssol_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lssol</span><span class="p">[</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1">#Working till here 2022-10-21 1530pm</span>

    <span class="n">multp</span> <span class="o">=</span> <span class="n">npm</span><span class="o">.</span><span class="n">repmat</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
    <span class="n">devint</span> <span class="o">=</span> <span class="n">bfDevRegAv</span> <span class="o">*</span> <span class="n">multp</span>
    <span class="n">multp</span> <span class="o">=</span> <span class="n">npm</span><span class="o">.</span><span class="n">repmat</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">leakLS</span> <span class="o">=</span> <span class="n">tsleaktotalf</span> <span class="o">*</span> <span class="n">multp</span>


    <span class="n">ps</span> <span class="o">=</span> <span class="n">PhaseCalc</span><span class="p">(</span><span class="n">tsleaktotalf</span><span class="p">,</span><span class="n">tsleaktotalff</span><span class="p">)</span>



    <span class="c1">#Compute the near true leakage</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cid</span><span class="p">):</span>   
        <span class="n">ftsleaktotal</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">naninterp</span><span class="p">(</span><span class="n">tsleaktotalf</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span> <span class="c1">#Replaces gaps (NaN values) with an itnerpolated value in the leakage time series from once filtered fields</span>
        <span class="n">fftsleaktotal</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">naninterp</span><span class="p">(</span><span class="n">tsleaktotalff</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span> <span class="c1">#replace the gaps (NaN values) with an interpolated value in leakage time series from twice filtered fields</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">ftsleaktotal</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span> <span class="c1">#take fast Fourier transform #check shape of X 2022-10-21</span>
        <span class="n">p</span> <span class="o">=</span> <span class="o">-</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">r</span> <span class="c1">#compute the fraction of the time period by which the time series is to be shiftes</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">r</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span> <span class="c1">#compute the Conjugate-Symmetric shift </span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="n">Y</span> <span class="c1">#Apply the shift</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="c1">#apply inverse fft</span>

        <span class="n">con</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">con</span>

        <span class="n">z</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="mi">2</span>

        <span class="n">leakage</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span> <span class="c1">#shifted timeseries</span>


        <span class="c1">#Shift timeseriecs from once filtered fields in the direction of the time series from twice filtered fields, to later compute the amplitude ratio</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">r</span> <span class="c1">#Fraction of a time period to shift data</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">r</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span> <span class="c1">#compute the Conjugate-Symmetric shift</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="n">Y</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="c1">#apply inverse fft</span>

        <span class="n">con</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">con</span>

        <span class="n">z</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="mi">2</span>

        <span class="n">leakager</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span> <span class="c1">#shifted timeseries</span>



    <span class="c1">#compute the ratio between the amplitude of the shifted leakage from once filtered fields and leakage from twice filtered fields</span>
    <span class="n">rfn</span> <span class="o">=</span> <span class="n">leakage</span><span class="o">/</span><span class="n">fftsleaktotal</span>
    <span class="n">rfn</span><span class="p">[(</span><span class="n">rfn</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">rfn</span><span class="p">[(</span><span class="n">rfn</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">rfn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rfn</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">rfn</span><span class="o">=</span><span class="n">rfn</span><span class="o">/</span><span class="n">r</span> <span class="c1"># amplitude ratio</span>


    <span class="n">lhat</span> <span class="o">=</span> <span class="n">leakager</span> <span class="o">*</span> <span class="n">rfn</span> <span class="c1">#apply the amplitude ratio to the shifted leakage timeseries from the once filtered fields to get the near true leakage</span>
    <span class="n">lhat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">FilteredTS</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c1">#reintroduce nan for data gaps</span>
    <span class="n">leakLS</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">FilteredTS</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">RecoveredTWS</span> <span class="o">=</span> <span class="n">FilteredTS</span> <span class="o">-</span> <span class="n">leakLS</span> <span class="o">-</span> <span class="n">devint</span>
    <span class="n">RecoveredTWS2</span> <span class="o">=</span> <span class="n">FilteredTS</span> <span class="o">-</span> <span class="n">lhat</span> <span class="o">-</span> <span class="n">devint</span>

    <span class="k">return</span> <span class="n">RecoveredTWS</span><span class="p">,</span> <span class="n">RecoveredTWS2</span><span class="p">,</span> <span class="n">FilteredTS</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="hydrological-applications-with-grace">Hydrological Applications with GRACE<a class="headerlink" href="#hydrological-applications-with-grace" title="Permanent link">&para;</a></h2>
<p><code>Basinaverage(temp, gs, shp_basin, basin_area):</code>
</p>


<div class="doc doc-object doc-function">



<a id="pyshbundle.hydro.Basinaverage"></a>
    <div class="doc doc-contents first">

        <p>Calculate the basin average of the total water storage (TWS) from the gridded TWS data.</p>
<p>Applies area weighting to the gridded TWS data and then clips the data to the basin shapefile.
Followed by summation of data over the latitude and longitude dimensions, divides it by basin
area to get the basin average TWS.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>temp</code></td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Gridded total water storage data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>gs</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Grid size.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>shp_basin</code></td>
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shapefile of the basin.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>basin_area</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Area of the basin in square meters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>basin_tws</code></td>            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total water storage data clipped to the basin.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>basin_avg_tws</code></td>            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Basin average total water storage.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyshbundle/hydro.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">Basinaverage</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">shp_basin</span><span class="p">,</span> <span class="n">basin_area</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the basin average of the total water storage (TWS) from the gridded TWS data.</span>

<span class="sd">    Applies area weighting to the gridded TWS data and then clips the data to the basin shapefile.</span>
<span class="sd">    Followed by summation of data over the latitude and longitude dimensions, divides it by basin</span>
<span class="sd">    area to get the basin average TWS.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp (xarray.DataArray): Gridded total water storage data.</span>
<span class="sd">        gs (float): Grid size.</span>
<span class="sd">        shp_basin (geopandas.GeoDataFrame): Shapefile of the basin.</span>
<span class="sd">        basin_area (float): Area of the basin in square meters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        basin_tws (xarray.DataArray): Total water storage data clipped to the basin.</span>
<span class="sd">        basin_avg_tws (xarray.DataArray): Basin average total water storage.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">pyshbundle.hydro</span> <span class="kn">import</span> <span class="n">area_weighting</span>
    <span class="c1"># area_weighting returns the area of each grid in m^2 for the grid resolution specified</span>
    <span class="n">temp_weighted</span><span class="o">=</span><span class="n">temp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">temp_weighted</span><span class="p">[</span><span class="s1">&#39;tws&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">temp</span><span class="p">[</span><span class="s1">&#39;tws&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">area_weighting</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39; add projection system to nc &#39;&#39;&#39;</span>
    <span class="n">basin_tws</span> <span class="o">=</span> <span class="n">temp_weighted</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">write_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">basin_tws</span> <span class="o">=</span> <span class="n">basin_tws</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">set_spatial_dims</span><span class="p">(</span><span class="n">x_dim</span><span class="o">=</span><span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="n">y_dim</span><span class="o">=</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># mask data with shapefile</span>
    <span class="n">basin_tws</span> <span class="o">=</span> <span class="n">basin_tws</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">shp_basin</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">mapping</span><span class="p">),</span> <span class="n">shp_basin</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">basin_avg_tws</span><span class="o">=</span><span class="n">basin_tws</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">),</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">/</span><span class="n">basin_area</span>  <span class="c1">#basin average tws</span>

    <span class="n">basin_tws</span><span class="o">=</span><span class="n">basin_tws</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s1">&#39;spatial_ref&#39;</span><span class="p">)</span>
    <span class="n">basin_avg_tws</span><span class="o">=</span><span class="n">basin_avg_tws</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s1">&#39;spatial_ref&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">basin_tws</span><span class="p">,</span> <span class="n">basin_avg_tws</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><p><code>TWSCalc(data, lmax: int, gs: float, r:float, m: int):</code>
</p>


<div class="doc doc-object doc-function">



<a id="pyshbundle.hydro.TWSCalc"></a>
    <div class="doc doc-contents first">

        <p>Spherical Harmonics Synthesis for Total Water Storage (TWS) calculation.</p>
<p>Calculate the total water storage (TWS) from spherical harmonics coefficients.
Uses spherical harmonics synthesis to go from harmonics to gridded domain.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spherical harmonics coefficients in SC format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lmax</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum degree of the spherical harmonics coefficients.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>gs</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Grid size.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>r</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Half-width of the Gaussian filter.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>m</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of time steps.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Gridded TWS data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="uses" open>
  <summary>Uses</summary>
  <p>'Gaussian', 'gshs'</p>
</details>

<details class="author" open>
  <summary>Author</summary>
  <p>Vivek Yadav, Interdisciplinary Center for Water Research (ICWaR), Indian Institute of Science (IISc)</p>
</details>
            <details class="quote">
              <summary>Source code in <code>pyshbundle/hydro.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">TWSCalc</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lmax</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">gs</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spherical Harmonics Synthesis for Total Water Storage (TWS) calculation.</span>

<span class="sd">    Calculate the total water storage (TWS) from spherical harmonics coefficients.</span>
<span class="sd">    Uses spherical harmonics synthesis to go from harmonics to gridded domain.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (numpy.ndarray): Spherical harmonics coefficients in SC format.</span>
<span class="sd">        lmax (int): Maximum degree of the spherical harmonics coefficients.</span>
<span class="sd">        gs (float): Grid size.</span>
<span class="sd">        r (float): Half-width of the Gaussian filter.</span>
<span class="sd">        m (int): Number of time steps.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (numpy.ndarray): Gridded TWS data.</span>

<span class="sd">    Uses:</span>
<span class="sd">        &#39;Gaussian&#39;, &#39;gshs&#39;</span>

<span class="sd">    Author:</span>
<span class="sd">        Vivek Yadav, Interdisciplinary Center for Water Research (ICWaR), Indian Institute of Science (IISc)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">SC</span> <span class="o">=</span> <span class="n">data</span>

    <span class="n">gfilter</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="n">lmax</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
    <span class="n">grid_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">gs</span><span class="p">)</span>
    <span class="n">grid_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">360</span><span class="o">/</span><span class="n">gs</span><span class="p">)</span>
    <span class="n">tws_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">m</span><span class="p">,</span><span class="n">grid_y</span><span class="p">,</span><span class="n">grid_x</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">)):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">SC</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">96</span><span class="o">-</span><span class="n">lmax</span><span class="p">:</span><span class="mi">96</span><span class="o">+</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">shfil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">shfil</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">gfilter</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">field</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span>

        <span class="n">quant</span> <span class="o">=</span> <span class="s1">&#39;water&#39;</span> 
        <span class="n">grd</span> <span class="o">=</span> <span class="s1">&#39;cell&#39;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">gs</span><span class="p">)</span> 
        <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="n">jflag</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">ff</span> <span class="o">=</span> <span class="n">gshs</span><span class="p">(</span><span class="n">shfil</span><span class="p">,</span> <span class="n">quant</span><span class="p">,</span> <span class="n">grd</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">jflag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ff</span> <span class="o">=</span> <span class="n">ff</span><span class="o">*</span><span class="mi">1000</span>    <span class="c1"># convert units from m to mm</span>
        <span class="n">tws_f</span><span class="p">[</span><span class="n">i</span><span class="p">,:,</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">grid_x</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ff</span><span class="p">[:,</span><span class="nb">int</span><span class="p">(</span><span class="n">grid_x</span><span class="o">/</span><span class="mi">2</span><span class="p">):]</span>
        <span class="n">tws_f</span><span class="p">[</span><span class="n">i</span><span class="p">,:,</span><span class="nb">int</span><span class="p">(</span><span class="n">grid_x</span><span class="o">/</span><span class="mi">2</span><span class="p">):]</span> <span class="o">=</span> <span class="n">ff</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">grid_x</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>   

    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tws_f</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tws_f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.525ec568.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>